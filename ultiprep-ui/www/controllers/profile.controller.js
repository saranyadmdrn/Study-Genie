var app=angular.module("ultiprep");app.controller("profileController",["$scope","$state","authentication","data",function(e,s,r,o){var a=this;a.isEditingName=!1,a.isEditingEmail=!1,a.currentUser={},a.dummyUser={},a.changePassword={oldPassword:"",newPassword:"",confirmNewPassword:""},a.removeUserConfirmation={password:""},o.getUser().success(function(e){a.dummyUser._id=e._id,a.dummyUser.name=e.name,a.dummyUser.email=e.email,a.currentUser=e}).error(function(e){alertToast("Could not load user details. "+e.message)}),window.chartColors={red:"rgb(255, 99, 132)",orange:"rgb(255, 159, 64)",yellow:"rgb(255, 205, 86)",green:"rgb(75, 192, 192)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)"},o.getUsageData().success(function(e){console.log(e.userResults);var s={labels:["Early morning","Morning","Noon","Evening","Night"],datasets:[{type:"line",label:"Other users' Usage",borderColor:window.chartColors.blue,borderWidth:2,fill:!1,data:e.othersResults},{type:"bar",label:"Your Usage",backgroundColor:window.chartColors.red,data:e.userResults,borderColor:"white",borderWidth:2}]},r=document.getElementById("usage-canvas").getContext("2d");window.myMixedChart=new Chart(r,{type:"bar",data:s,options:{responsive:!0,title:{display:!0,text:"Usage Statistics"},tooltips:{mode:"index",intersect:!0}}})}).error(function(e){alertToast(e.message)}),o.getFavoriteTags().success(function(e){console.log(e);for(var s=[],r=[],o=0;o<e.length;o++)s.push(e[o].data),r.push(e[o]._id.label);var a={type:"doughnut",data:{datasets:[{data:s,backgroundColor:[window.chartColors.red,window.chartColors.orange,window.chartColors.yellow,window.chartColors.green,window.chartColors.blue],label:"Dataset"}],labels:r},options:{responsive:!0,legend:{position:"top"},title:{display:!0,text:"Hot Topics"},animation:{animateScale:!0,animateRotate:!0}}},t=document.getElementById("tags-canvas").getContext("2d");window.myDoughnut=new Chart(t,a)}).error(function(e){alertToast(e.message)}),a.updateUser=function(){return!a.isEditingName||"string"==typeof a.dummyUser.name&&0!=a.dummyUser.name.length?!a.isEditingEmail||"string"==typeof a.dummyUser.email&&0!=a.dummyUser.email.length?void o.updateUser(a.dummyUser).success(function(){a.isEditingName=!1,a.isEditingEmail=!1,alertToast("Saved.","success"),o.getUser().success(function(e){a.dummyUser._id=e._id,a.dummyUser.name=e.name,a.dummyUser.email=e.email,a.currentUser=e,a.$parent.currentUser=e}).error(function(e){alertToast("Could not load user details. "+e.message)})}).error(function(e){alertToast(e.message)}):(alertToast("Valid email address is required."),void(a.dummyUser.email=a.currentUser.email)):(alertToast("Name is required."),void(a.dummyUser.name=a.currentUser.name))},a.changeUserPassword=function(){"string"==typeof a.changePassword.oldPassword&&"string"==typeof a.changePassword.newPassword&&"string"==typeof a.changePassword.confirmNewPassword&&0!==a.changePassword.oldPassword.length&&0!==a.changePassword.newPassword.length&&0!==a.changePassword.confirmNewPassword.length?a.changePassword.newPassword===a.changePassword.confirmNewPassword?o.changeUserPassword(a.changePassword).success(function(){$("#change-password-modal").modal("hide"),alertToast("Saved.","success")}).error(function(e){alertToast(e.message)}):alertToast("The passwords do not match."):alertToast("Please enter your old password, new password and its confirmation.")},a.removeUser=function(){"string"==typeof a.removeUserConfirmation.password&&0!==a.removeUserConfirmation.password.length?o.removeUser(a.removeUserConfirmation.password).success(function(){$("#delete-account-modal").modal("hide"),r.logOut(),swal({title:"",text:"Deleted.",imageUrl:"assets/images/animation-removed.gif",confirmButtonText:"OK"},function(){location.reload()})}).error(function(e){alertToast(e.message)}):alertToast("Password is required for confirmation.")},setBackButtonToModalClose(),setLayout(5)}]);